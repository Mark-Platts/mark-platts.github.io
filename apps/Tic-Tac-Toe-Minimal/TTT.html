<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Welcome! </title>
  </head>

  <body style="background-color: #110A08;"> <!-- rgb(24, 10, 8) #171219  -->
    <div id="infoHolder">
      <center>
        <p>Welcome to my website, soon to be the home of my portfolio.</p>
        <p>I have a lot of projects planned and I'm busy making them ready to show off here.</p>
        <p>Until then, why not play some some noughts and crosses?</p>
        <button type="button" id="easyButton" onclick="startEasy()">Easy!</button>
        <button type="button" id="hardButton" onclick="startHard()">Hard!</button>
      </center>
    </div>

    <div id="gameHolder" style="background-color: #fffad3; padding: 0.2vw;"> <!-- rgb(251, 247, 234) #171219 -->
    </div>



  </body>

  <style>

    #infoHolder {
      background-color: #84b5f2;  /* rgb(170, 255, 255); #6A66A3 #6389BA */
      background-repeat: no-repeat;
      background-size: 100% 100%;
      /*font-weight: bold;*/
      color: #36382e;
      font-family: "Georgia";
    }

    #BrdBk {
       /*border: 1px solid black;*/
       border-collapse:collapse;
       width: 100%;
       height: 100%;
    }

    button {
      background-color: #555555;
      color: white;
      cursor: pointer;
      border: none;
    }


    .allcell {
      border-style: solid;
      border-color: black;
      border-width: 2px;
    }

    .Brdcorner {
       width: 5%;
       height: 5%;
       max-width:5%;
       min-width:5%;
       max-height:5%;
       min-height:5%;
       visibility: collapse;
    }

    .Brdtopbottom {
       height: 5%;
       width: 5%;
       max-width:5%;
       min-width:5%;
       max-height:5%;
       min-height:5%;
       visibility: collapse;
    }

    .Brdleftright {
       width: 5%;
       max-width:5%;
       min-width:5%;
       visibility: collapse;
    }

    .Brdspace {
       height: 30%;
       width: 30%;
       max-width:30%;
       min-width:30%;
       max-height:30%;
       min-height:30%;
    }

  </style>

  <script>
    //page script

    //constructs the page
    function constructPage() {
      const sizePercent = 0.95 //to shrink things if necessary
      const innerWidth = sizePercent*window.innerWidth;
      const innerHeight = sizePercent*window.innerHeight;
      //Sets both divs to 1:1 aspect ratio that will fit screen
      let divWidth = (innerWidth < innerHeight) ? innerWidth:innerHeight;
      let divHeight = (innerWidth < innerHeight) ? innerWidth:innerHeight;
      if (innerWidth > 600 && innerHeight > 600) {
        divWidth = 600;
        divHeight = 600;
      }
      shapeMainDiv("infoHolder", divHeight, divWidth);
      shapeMainDiv("gameHolder", divHeight, divWidth);
      buttonSizer("easyButton", divHeight, divWidth);
      buttonSizer("hardButton", divHeight, divWidth);
      document.getElementById("infoHolder").style['z-index'] = '1';
      document.getElementById("gameHolder").style['z-index'] = '0';
    }

    //resizes the main divs if page is resized
    function mainDivResize() {
      const sizePercent = 0.95 //to shrink things if necessary
      const innerWidth = sizePercent*window.innerWidth;
      const innerHeight = sizePercent*window.innerHeight;
      //Sets both divs to 1:1 aspect ratio that will fit screen
      let divWidth = (innerWidth < innerHeight) ? innerWidth:innerHeight;
      let divHeight = (innerWidth < innerHeight) ? innerWidth:innerHeight;
      if (innerWidth > 600 && innerHeight > 600) {
        divWidth = 600;
        divHeight = 600;
      }
      shapeMainDiv("infoHolder", divHeight, divWidth);
      shapeMainDiv("gameHolder", divHeight, divWidth);
      buttonSizer("easyButton", divHeight, divWidth);
      buttonSizer("hardButton", divHeight, divWidth);
    }

    //Takes a div id and adds the mainDiv styles to it
    function shapeMainDiv(id, divHeight, divWidth) {
      const innerWidth = window.innerWidth;
      const innerHeight = window.innerHeight;
      const fontPerc = 0.04;
      const padPerc = 0.01;
      document.getElementById(id).style.height = String(divHeight)+'px';
      document.getElementById(id).style.width = String(divWidth)+'px';
      document.getElementById(id).style['border-radius'] = String(0.07*divHeight)+'px';
      document.getElementById(id).style.position = 'fixed';
      document.getElementById(id).style.left = String((innerWidth-divWidth)/2 - divHeight*padPerc)+'px';
      document.getElementById(id).style.top = String((innerHeight-divHeight)/2 - divHeight*padPerc)+'px';
      document.getElementById(id).style['font-size'] = String(divHeight*fontPerc)+'px';
      document.getElementById(id).style.padding = String(divHeight*padPerc)+'px';
    }

    //Resizes buttons
    function buttonSizer(id, divHeight, divWidth) {
      const fontPerc = 0.04;
      document.getElementById(id).style.height = String(divHeight*0.1)+'px';
      document.getElementById(id).style.width = String(divWidth*0.2)+'px';
      document.getElementById(id).style['font-size'] = String(divHeight*fontPerc)+'px';
      document.getElementById(id).style['margin-top'] = String(divHeight/16)+'px';
    }

    //game script
    let whoGo = 'X';

  

    const initState = {
      11:"E",12:"E",13:"E",
      21:"E",22:"E",23:"E",
      31:"E",32:"E",33:"E"
    };

    let gameState = {
      11:"E",12:"E",13:"E",
      21:"E",22:"E",23:"E",
      31:"E",32:"E",33:"E"
    };

    //Hides the infoHolder to reveal the gameHolder with no ai
    function startEasy() {
      document.getElementById("infoHolder").style['z-index'] = '-1';
      win = 0;
      turn = 0;
      for (i in gameState){
        gameState[i] = initState[i];
      }
      for (i in possMoves){
        possMoves[i] = initpossMoves[i];
      }
      artInt = 0;
      drawboard(gameState);
    }
    //Hides the infoHolder to reveal the gameHolder with ai
    function startHard() {
      document.getElementById("infoHolder").style['z-index'] = '-1';
      win = 0;
      turn = 0;
      for (i in gameState){
        gameState[i] = initState[i];
      }
      for (i in possMoves){
        possMoves[i] = initpossMoves[i];
      }
      artInt = 1;
      drawboard(gameState);
    }

    //creates the board and adds it to gameHolder
    function createBoard(id) {
      let hold = "<table id= 'BrdBk'>";
      for (y = 0; y < 5; y++) {
         if (y == 0 || y == 4) {
            hold += "<tr class = 'Brdtopbottom'>";
         }
         else {
            hold += "<tr class = 'Brdspace'>";
         }
         for(x = 0; x < 5; x++){
           if(x == 0 || x == 4){
              hold += "<td class = 'Brdleftright'></td>";
           }
           else if (y == 0 || y == 4) {
              hold += "<td class = 'Brdtopbottom'></td>";
           }
           else{
              hold += "<td class = 'Brdspace allcell' id = "+x+y+" onclick='clickAns(this.id)'></td>";
           }
         }
         hold += "</tr>";
       }
      hold += "</table>";
      document.getElementById(id).innerHTML = hold;
    }

    function clickAns(id){
      if (possMoves[id] == 1){
        //Human move
        gameState[id] = 'X';
        possMoves[id] = 0;
        turn = turn + 1;
        drawboard(gameState);
        checkWin(gameState, 'X');
        checkDraw(gameState);
        //Computer Move
        if (win != 1 && turn < 8) {
          let compMove = computerMove(gameState);
          gameState[compMove] = 'O';
          possMoves[compMove] = 0;
          turn = turn + 1;
          drawboard(gameState);
          checkWin(gameState, 'O');
          checkDraw(gameState);
        }
      }
    };


  

    //draw state to table stuff
    function drawboard(state){
      for (i in state){
        document.getElementById(i).innerHTML = "<img src='images/NC-"+state[i]+".png' style='display:block;' width='99%' height='auto'>";
      }
    }



    //possible moves and win stuff
    const initpossMoves = {11:1,12:1,13:1,21:1,22:1,23:1,31:1,32:1,33:1};
    let possMoves = {11:1,12:1,13:1,21:1,22:1,23:1,31:1,32:1,33:1};
    const winstates = [[11,12,13,"w4"],[21,22,23,"w5"],[31,32,33,"w6"],[11,21,31,"w1"],[12,22,32,"w2"],[13,23,33,"w3"],[11,22,33,"w7"],[13,22,31,"w8"]];
    let turn = 0;
    let endNote = "";
    let win = 0;
    let artInt = 0;

    function checkWin(state, whoWins){
      for (i of winstates){
        if (state[i[0]] == state[i[1]] && state[i[1]] == state[i[2]] && state[i[0]] != "E"){
          endNote = whoWins+" Wins! Play again?";
          win = 1;
          document.getElementById("infoHolder").style.backgroundImage = "url('images/NC-" + i[3] + ".png')";
          endOn(endNote);
        }
      }
    };

    function checkDraw(state){
      if (win == 0 && turn > 8){
        endNote = "It's a Draw! Play again?";
        document.getElementById("infoHolder").style.backgroundImage = 'none';
        endOn(endNote)
      }
    }
    
    //a.i. code

    //computer makes a move RENAME TO RANDOM AFTER MAKING HARDMODE
    function computerMove(state) {
      if (artInt == 0) {
        return easyCompMov();
      }
      else if (artInt == 1) {
        return hardCompMov(state);
      }
    }

    //Returns a move for easy mode
    function easyCompMov() {
      let possMoveList = [];
      for (i in possMoves) {
        if (possMoves[i] == 1) {
          possMoveList.push(i);
        }
      }
      return possMoveList[Math.floor(Math.random()*possMoveList.length)];
    }

    //Returns a move for hard mode
    function hardCompMov(state) {
      let possMoveList = [];
      for (let i = 0; i < winstates.length; i++) {
        let t0 = winstates[i][0];
        let t1 = winstates[i][1];
        let t2 = winstates[i][2];
        if (state[t0] == "X" && state[t1] == "X" && state[t2] == "E") {
          possMoveList.push(t2)
        }
        if (state[t0] == "X" && state[t1] == "E" && state[t2] == "X") {
          possMoveList.push(t1)
        }
        if (state[t0] == "E" && state[t1] == "X" && state[t2] == "X") {
          possMoveList.push(t0)
        }
      }
      if (possMoveList.length == 0) {
        return easyCompMov();
      }
      else {
        return possMoveList[Math.floor(Math.random()*possMoveList.length)];
      }
    }
    


    //Brings infoHolder back with end game text
    function endOn(endNote) {
      document.getElementById("infoHolder").style['z-index'] = '1';
      document.getElementById("infoHolder").style['background-color'] = 'transparent';
      document.getElementById("infoHolder").innerHTML = '<center>'+endNote + '<br> <button type="button" id="easyButton" onclick="startEasy()">Easy!</button><button type="button" id="hardButton" onclick="startHard()">Hard!</button></center>';
      mainDivResize();
    }


    //script to run

    constructPage();

    createBoard("gameHolder");

    window.onresize = mainDivResize;

  </script>

</html>
